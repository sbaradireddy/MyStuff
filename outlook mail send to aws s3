import os
import boto3
import win32com.client

# AWS S3 configuration
BUCKET_NAME = 'your-s3-bucket-name'
AWS_REGION = 'your-aws-region'

# Local directory to temporarily store attachments
ATTACHMENTS_DIR = 'C:/path/to/save/attachments'

# Outlook configuration
OUTLOOK_FOLDER = 'Inbox'  # Specify the Outlook folder to monitor

# Initialize S3 client
s3_client = boto3.client('s3', region_name=AWS_REGION)

# Function to connect to Outlook and download attachments
def download_outlook_attachments():
    outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
    inbox = outlook.Folders.Item(1).Folders[OUTLOOK_FOLDER]
    messages = inbox.Items

    for message in messages:
        if message.Attachments.Count > 0:
            for attachment in message.Attachments:
                # Save the attachment locally
                file_path = os.path.join(ATTACHMENTS_DIR, attachment.FileName)
                attachment.SaveAsFile(file_path)
                print(f"Downloaded {attachment.FileName} to {ATTACHMENTS_DIR}")

                # Upload the file to S3
                upload_to_s3(file_path, attachment.FileName)

                # Optionally, delete the local file after uploading
                os.remove(file_path)

# Function to upload files to S3
def upload_to_s3(file_path, file_name):
    try:
        s3_client.upload_file(file_path, BUCKET_NAME, file_name)
        print(f"Uploaded {file_name} to S3 bucket {BUCKET_NAME}")
    except Exception as e:
        print(f"Failed to upload {file_name} to S3: {e}")

# Main function
if __name__ == "__main__":
    download_outlook_attachments()
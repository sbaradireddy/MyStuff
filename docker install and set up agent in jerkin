To install Docker and set up a Docker agent in Jenkins, follow these step-by-step instructions. This guide covers the installation of Docker on a Jenkins machine and the configuration of Docker as an agent in Jenkins.

Part 1: Install Docker on the Jenkins Machine
Step 1: Install Docker (on Ubuntu)

Update the package list:
bash
Copy code
sudo apt update
Install the necessary packages:
bash
Copy code
sudo apt install apt-transport-https ca-certificates curl software-properties-common
Add Docker’s official GPG key:
bash
Copy code
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
Add Docker’s APT repository:
bash
Copy code
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
Update the package list again:
bash
Copy code
sudo apt update
Install Docker:
bash
Copy code
sudo apt install docker-ce
Verify Docker is installed:
bash
Copy code
docker --version
You should see something like:

Copy code
Docker version 20.10.12, build e91ed57
Start and enable Docker:
bash
Copy code
sudo systemctl start docker
sudo systemctl enable docker
Step 2: Add Jenkins User to the Docker Group

Add the Jenkins user to the Docker group so that Jenkins can execute Docker commands:
bash
Copy code
sudo usermod -aG docker jenkins
Restart Jenkins:
bash
Copy code
sudo systemctl restart jenkins
Log out and log back in to ensure group membership is reloaded for the Jenkins user.
Part 2: Install Docker Plugin in Jenkins
Step 3: Install the Docker Plugin

Go to Jenkins Dashboard > Manage Jenkins > Manage Plugins.
Select the Available tab and search for Docker Plugin.
Select Docker Plugin and click Install without restart.
Part 3: Set Up Docker Agent in Jenkins
Step 4: Configure Jenkins to Use Docker as an Agent

Go to Jenkins Dashboard > Manage Jenkins > Configure Clouds.
Click on Add a new cloud and select Docker from the list.
In the Docker Cloud section:
Docker Host URI: Set the Docker host URL. If Docker is installed locally on the same machine as Jenkins, use:
perl
Copy code
unix:///var/run/docker.sock
Test Connection: Click on Test Connection to ensure that Jenkins can communicate with Docker. It should show "Connected to Docker Daemon".
Step 5: Add a Docker Agent Template

Under the Docker Agent Templates section, click Add Docker Template.
Configure the Docker agent:
Labels: Give a label to the agent, e.g., docker-agent.
Docker Image: Set the Docker image for the agent. For example:
bash
Copy code
jenkins/inbound-agent
Remote FS Root: This is the directory where Jenkins will store files inside the container. Set this to:
arduino
Copy code
/home/jenkins/agent
Connect method: Choose Attach Docker container (the default).
Configure other options if needed, such as the container’s volumes or environment variables.
Part 4: Test the Docker Agent
Step 6: Create a Job to Use the Docker Agent

Go to the Jenkins Dashboard.
Click New Item > Freestyle project > Name the project and click OK.
Scroll to the Restrict where this project can be run option and check the box.
In the Label Expression, enter the label for the Docker agent (e.g., docker-agent).
Add a build step: click Add build step > Execute shell and enter:
bash
Copy code
echo "Running on Docker Agent"
docker --version
Step 7: Build the Job

Save the job and click Build Now to trigger the build.
Check the Console Output to verify that the job is running on the Docker agent.
You should see output confirming that Docker was used as the agent and showing the Docker version.
Part 5: Optional - Advanced Setup
Custom Docker Images:

If you need a custom agent image with pre-installed tools and dependencies, you can create a custom Dockerfile and use that image in the agent configuration.

Scaling Docker Agents:

You can configure Jenkins to spin up multiple Docker agents dynamically based on load. This helps scale Jenkins jobs efficiently.

Troubleshooting Tips
Permission Errors: If you get permission errors, make sure that the Jenkins user is added to the Docker group (sudo usermod -aG docker jenkins) and that Jenkins is restarted.
Failed to Test Connection: Ensure that Docker is running and the correct Docker Host URI is configured.
Docker not Found: If Jenkins can't find Docker, verify that Docker is installed properly on the Jenkins machine.
This completes the process of installing Docker and setting up Docker as an agent in Jenkins!
